{% extends "layout.html" %}
{% block title %}Data Table{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

<div class="max-w-6xl mx-auto space-y-12 py-8">

  <!-- My Data Points -->
  <section class="bg-white p-6 rounded-lg shadow">
    <h2 class="text-2xl font-semibold mb-4">My Data Points</h2>
    {% if my_data %}
      <div class="overflow-x-auto">
        <table id="ownTable" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Country</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Excess Deaths</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Lower Bound</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Upper Bound</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Confirmed Deaths</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for d in my_data %}
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 text-gray-700">{{ d.region }}</td>
                <td class="px-4 py-3 text-gray-700">{{ d.date }}</td>
                <td class="px-4 py-3 text-gray-700">{{ d.value }}</td>
                <td class="px-4 py-3 text-gray-700">{{ d.lower_bound or "N/A" }}</td>
                <td class="px-4 py-3 text-gray-700">{{ d.upper_bound or "N/A" }}</td>
                <td class="px-4 py-3 text-gray-700">{{ d.confirmed_deaths or "N/A" }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-gray-600">You havenâ€™t added any data yet. 
        <a href="{{ url_for('main.manual_entry') }}" class="text-indigo-600 hover:underline">Add some now</a>.
      </p>
    {% endif %}
  </section>

  <!-- Data Shared With Me -->
  <section class="bg-white p-6 rounded-lg shadow">
    <h2 class="text-2xl font-semibold mb-4">Data Shared With Me</h2>
    {% if shared_shares %}
      <div class="overflow-x-auto">
        <table id="sharedTable" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Country</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Excess Deaths</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Lower Bound</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Upper Bound</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Confirmed Deaths</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Shared By</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for share in shared_shares %}
              {% set d = share.data_point %}
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 text-gray-700">{{ d.region }}</td>
                <td class="px-4 py-3 text-gray-700">{{ d.date }}</td>
                <td class="px-4 py-3 text-gray-700">{{ d.value }}</td>
                <td class="px-4 py-3 text-gray-700">{{ d.lower_bound or "N/A" }}</td>
                <td class="px-4 py-3 text-gray-700">{{ d.upper_bound or "N/A" }}</td>
                <td class="px-4 py-3 text-gray-700">{{ d.confirmed_deaths or "N/A" }}</td>
                <td class="px-4 py-3 text-gray-700">{{ share.owner.email }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-gray-600">No one has shared data with you yet.</p>
    {% endif %}
  </section>

  <!-- Return Home Button -->
  <div class="flex justify-center">
    <a href="{{ url_for('main.index') }}"
       class="px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">
      Return to Home
    </a>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
  $(function() {
    $('#ownTable').DataTable({
      order: [[1, 'desc']],
      responsive: true,
      paging: false,
      info: false,
      searching: false
    });
    $('#sharedTable').DataTable({
      order: [[1, 'desc']],
      responsive: true,
      paging: false,
      info: false,
      searching: false
    });
  });
</script>
{% endblock %}
